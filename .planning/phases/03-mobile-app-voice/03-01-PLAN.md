---
phase: 03-mobile-app-voice
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - mobile-app/package.json
  - mobile-app/tsconfig.json
  - mobile-app/vite.config.ts
  - mobile-app/capacitor.config.ts
  - mobile-app/tailwind.config.js
  - mobile-app/postcss.config.js
  - mobile-app/src/types/index.ts
  - mobile-app/index.html
  - mobile-app/src/main.tsx
  - mobile-app/src/App.tsx
  - mobile-app/src/index.css
autonomous: true

must_haves:
  truths:
    - "Capacitor project initialized with React + Vite + TypeScript"
    - "Android platform added and configured for cleartext traffic"
    - "All required dependencies installed"
    - "Type definitions exist for app domain"
  artifacts:
    - path: "mobile-app/package.json"
      provides: "Project dependencies"
      contains: "@capacitor/core"
    - path: "mobile-app/capacitor.config.ts"
      provides: "Capacitor configuration with cleartext enabled"
      contains: "cleartext: true"
    - path: "mobile-app/src/types/index.ts"
      provides: "Shared type definitions"
      exports: ["QueuedTranscription", "Device", "RecordingState"]
  key_links:
    - from: "mobile-app/capacitor.config.ts"
      to: "android platform"
      via: "webDir: dist"
      pattern: "webDir.*dist"
---

<objective>
Initialize the Capacitor + React mobile app project with all dependencies, TypeScript configuration, Tailwind CSS, and shared type definitions.

Purpose: Establish the foundation for all mobile app development with proper build tooling and type safety.
Output: Working Vite + React + Capacitor project with Android platform configured.
</objective>

<execution_context>
@C:\Users\luish\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\luish\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-mobile-app-voice/03-RESEARCH.md
@backend-server/src/types/messages.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Capacitor project and install dependencies</name>
  <files>
    mobile-app/package.json
    mobile-app/tsconfig.json
    mobile-app/vite.config.ts
    mobile-app/index.html
    mobile-app/src/main.tsx
    mobile-app/src/App.tsx
    mobile-app/src/index.css
  </files>
  <action>
    1. Create Vite React TypeScript project:
       ```
       npm create vite@latest mobile-app -- --template react-ts
       cd mobile-app
       ```

    2. Install Capacitor core dependencies:
       ```
       npm install @capacitor/core @capacitor/android
       npm install -D @capacitor/cli
       ```

    3. Install plugin dependencies:
       ```
       npm install @capgo/capacitor-speech-recognition
       npm install capacitor-zeroconf
       npm install @capacitor/preferences @capacitor/network
       ```

    4. Install UI and state dependencies:
       ```
       npm install zustand uuid
       npm install -D @types/uuid
       ```

    5. Install Tailwind CSS:
       ```
       npm install -D tailwindcss postcss autoprefixer
       npx tailwindcss init -p
       ```

    6. Update src/index.css with Tailwind directives:
       ```css
       @tailwind base;
       @tailwind components;
       @tailwind utilities;
       ```

    7. Clear default App.tsx content, replace with minimal placeholder:
       ```tsx
       function App() {
         return (
           <div className="min-h-screen bg-gray-100">
             <h1 className="text-xl font-bold p-4">Objetiva Speecher</h1>
           </div>
         );
       }
       export default App;
       ```
  </action>
  <verify>
    Run `cd mobile-app && npm run dev` - Vite dev server starts without errors.
    Open http://localhost:5173 - shows "Objetiva Speecher" heading.
  </verify>
  <done>
    Vite + React project created with all dependencies installed.
    Dev server runs, Tailwind styles apply.
  </done>
</task>

<task type="auto">
  <name>Task 2: Configure Capacitor and add Android platform</name>
  <files>
    mobile-app/capacitor.config.ts
  </files>
  <action>
    1. Initialize Capacitor (run from mobile-app directory):
       ```
       npx cap init "Objetiva Speecher" com.objetiva.speecher --web-dir dist
       ```

    2. Create/update capacitor.config.ts with cleartext enabled per research:
       ```typescript
       import type { CapacitorConfig } from '@capacitor/cli';

       const config: CapacitorConfig = {
         appId: 'com.objetiva.speecher',
         appName: 'Objetiva Speecher',
         webDir: 'dist',
         android: {
           allowMixedContent: true,
         },
         server: {
           cleartext: true,  // Required for HTTP to local network backend
         },
       };

       export default config;
       ```

    3. Build the web app:
       ```
       npm run build
       ```

    4. Add Android platform:
       ```
       npx cap add android
       ```

    5. Sync native project:
       ```
       npx cap sync
       ```
  </action>
  <verify>
    Run `ls mobile-app/android` - android/ directory exists with native project files.
    Run `cat mobile-app/capacitor.config.ts | grep cleartext` - shows "cleartext: true".
  </verify>
  <done>
    Android platform added.
    Capacitor configured with cleartext traffic enabled.
    Native project synced.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create shared type definitions</name>
  <files>
    mobile-app/src/types/index.ts
    mobile-app/tailwind.config.js
  </files>
  <action>
    1. Create src/types directory and index.ts with all shared types:

    ```typescript
    // Recording flow states
    export type RecordingState = 'idle' | 'recording' | 'editing';

    // Device with online status (for device selector)
    export interface Device {
      hostname: string;
      isOnline: boolean;
    }

    // Queued transcription (persisted in Preferences)
    export interface QueuedTranscription {
      id: string;
      deviceId: string;
      text: string;
      timestamp: number;
    }

    // Connection status
    export type ConnectionStatus = 'online' | 'offline' | 'reconnecting';

    // Speech recognition error with Spanish message
    export interface SpeechError {
      code: number;
      message: string;  // Already translated to Spanish
    }

    // API response types (match backend types/messages.ts)
    export interface ApiSuccessResponse {
      success: true;
      queued?: boolean;
      messageId?: string;
    }

    export interface ApiErrorResponse {
      success: false;
      error: {
        code: 'AGENT_OFFLINE' | 'QUEUE_FULL' | 'INVALID_DEVICE_ID' | 'INTERNAL_ERROR' | 'ACK_TIMEOUT';
        message: string;
      };
    }

    export type ApiResponse = ApiSuccessResponse | ApiErrorResponse;

    // Devices endpoint response
    export interface DevicesResponse {
      success: boolean;
      devices: string[];
    }

    // Backend service discovered via mDNS or manual config
    export interface BackendService {
      hostname: string;
      ip: string;
      port: number;
      url: string;  // Computed: http://{ip}:{port}
    }
    ```

    2. Update tailwind.config.js to scan src files:
    ```javascript
    /** @type {import('tailwindcss').Config} */
    export default {
      content: [
        "./index.html",
        "./src/**/*.{js,ts,jsx,tsx}",
      ],
      theme: {
        extend: {},
      },
      plugins: [],
    }
    ```
  </action>
  <verify>
    Run `cat mobile-app/src/types/index.ts | grep "export"` - shows all type exports.
    TypeScript compiles: `cd mobile-app && npx tsc --noEmit` passes.
  </verify>
  <done>
    All shared types defined matching backend API contracts.
    Tailwind configured to process all source files.
    TypeScript compiles without errors.
  </done>
</task>

</tasks>

<verification>
1. `cd mobile-app && npm run build` completes without errors
2. `ls mobile-app/android/app` shows Android native project structure
3. `cat mobile-app/capacitor.config.ts` shows cleartext: true
4. `cat mobile-app/src/types/index.ts` exports all required types
5. `cd mobile-app && npx tsc --noEmit` passes
</verification>

<success_criteria>
- Vite dev server runs and shows app
- Android platform added and synced
- Capacitor configured for local network HTTP
- All type definitions match backend contracts
- TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/03-mobile-app-voice/03-01-SUMMARY.md`
</output>
