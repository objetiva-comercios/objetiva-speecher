---
phase: 03-mobile-app-voice
plan: 08
type: execute
wave: 4
depends_on: ["03-07"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "User can dictate on Android and text appears on PC"
    - "End-to-end latency under 2 seconds"
    - "Transcriptions queue when offline and deliver on reconnect"
    - "Speech recognition errors display Spanish messages"
  artifacts: []
  key_links:
    - from: "mobile-app"
      to: "backend-server"
      via: "POST /transcription"
      pattern: "transcription"
    - from: "backend-server"
      to: "windows-agent"
      via: "WebSocket"
      pattern: "transcription"
---

<objective>
Verify end-to-end functionality of the complete voice-to-paste flow on real Android device.

Purpose: Validate that all components work together correctly in production-like environment.
Output: Verified working system ready for daily use.
</objective>

<execution_context>
@C:\Users\luish\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\luish\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/03-mobile-app-voice/03-CONTEXT.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build and install Android APK</name>
  <files></files>
  <action>
    Build the Android APK and prepare for device installation.

    1. Ensure all code is synced:
    ```bash
    cd mobile-app
    npm run build
    npx cap sync android
    ```

    2. Open Android project in Android Studio:
    ```bash
    npx cap open android
    ```

    3. Or build directly via command line:
    ```bash
    cd android
    ./gradlew assembleDebug
    ```

    4. The APK will be at:
    `android/app/build/outputs/apk/debug/app-debug.apk`

    5. Install on connected device:
    ```bash
    adb install android/app/build/outputs/apk/debug/app-debug.apk
    ```

    Note: User needs Android device connected via USB with USB debugging enabled.
  </action>
  <verify>
    APK exists: `ls mobile-app/android/app/build/outputs/apk/debug/`
    App installed: `adb shell pm list packages | grep objetiva`
  </verify>
  <done>
    APK built successfully.
    App installed on Android device.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Verify end-to-end voice-to-paste flow</name>
  <what-built>
    Complete mobile app with voice recognition, device selection, offline queue, and backend integration.
    Full system: Android app -> Backend server -> Windows agent.
  </what-built>
  <how-to-verify>
    **Prerequisites:**
    1. Start backend server: `cd backend-server && npm run dev`
    2. Start Windows agent: `cd windows-agent && npm run dev`
    3. Open a text editor (Notepad, VS Code) on PC
    4. Launch Objetiva Speecher app on Android

    **Test 1: Basic Flow**
    1. App should show device selector with your PC hostname
    2. Tap the microphone button
    3. Speak a sentence in Spanish (e.g., "Hola mundo, esto es una prueba")
    4. Observe live text appearing during speech
    5. Tap stop button
    6. Edit text if desired
    7. Tap "Enviar"
    8. Text should appear in the text editor on PC
    Expected: Text appears within 2 seconds of tapping send

    **Test 2: Device Selection**
    1. With multiple agents connected (or just one), verify dropdown shows hostnames
    2. Verify green dot appears for connected devices
    3. Select a device and confirm it's remembered on app restart

    **Test 3: Offline Queue**
    1. Enable airplane mode on phone
    2. Tap record, speak, stop, send
    3. Observe message appears in "Pendientes" queue
    4. Disable airplane mode
    5. Queue should replay automatically and clear

    **Test 4: Error Handling**
    1. While recording, make no sound for 10+ seconds
    2. Should see "No se detecto voz" message
    3. Message should be in Spanish, not English

    **Test 5: Swipe to Delete**
    1. Create a queued item (send while offline)
    2. Swipe left on the queued item
    3. Item should delete

    **Latency Check:**
    - Measure time from tap-stop to text appearing on PC
    - Should be under 2 seconds (P95)
  </how-to-verify>
  <resume-signal>
    Report results:
    - "approved" if all tests pass
    - Or describe any issues found
  </resume-signal>
</task>

</tasks>

<verification>
1. APK built and installed on device
2. Basic voice-to-paste flow works
3. Device selection works with status dots
4. Offline queue persists and replays
5. Error messages in Spanish
6. Latency under 2 seconds
</verification>

<success_criteria>
Per Phase 3 Success Criteria from ROADMAP.md:
1. User taps button, speaks in Spanish, sees partial transcription, taps stop, text appears on selected PC
2. End-to-end latency from tap-stop to paste is under 2 seconds (P95)
3. User can select target PC from list of connected devices (by hostname)
4. Transcriptions made while offline are queued and delivered when connection restores
5. App shows connection status and handles speech recognition errors gracefully
</success_criteria>

<output>
After completion, create `.planning/phases/03-mobile-app-voice/03-08-SUMMARY.md`
</output>
